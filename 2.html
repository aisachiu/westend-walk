<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>West End Pro</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        :root { --gold: #d4af37; --velvet: #800020; --bg: #121212; --card: #1e1e1e; --tab-bg: #1a1a1a; }
        body { font-family: -apple-system, system-ui; background: var(--bg); color: white; margin: 0; height: 100vh; overflow: hidden; }
        
        /* Layout */
        header { background: #000; padding: 15px; text-align: center; border-bottom: 1px solid #333; height: 60px; box-sizing: border-box; }
        h1 { margin: 0; font-size: 1.1rem; color: var(--gold); letter-spacing: 1px; }
        
        #content { height: calc(100vh - 120px); overflow-y: auto; position: relative; }
        #map { height: 100%; width: 100%; display: none; } /* Hidden by default */
        
        /* List Styles */
        .search-box { padding: 10px; background: var(--bg); position: sticky; top: 0; z-index: 10; }
        input { width: 100%; padding: 12px; border-radius: 8px; border: none; background: var(--card); color: white; font-size: 16px; box-sizing: border-box; }
        .list { padding: 10px; }
        .card { background: var(--card); border-radius: 10px; padding: 12px; margin-bottom: 10px; display: flex; align-items: center; border-left: 4px solid var(--gold); }
        .info { flex: 1; }
        .n { font-weight: bold; display: block; }
        .s { color: var(--gold); font-size: 0.9rem; font-style: italic; }
        .dist { font-size: 0.7rem; color: #888; margin-top: 4px; display: block; }
        
        /* Tab Bar */
        .tab-bar { height: 60px; background: var(--tab-bg); border-top: 1px solid #333; display: flex; position: fixed; bottom: 0; width: 100%; }
        .tab { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; color: #888; font-size: 0.7rem; text-decoration: none; border: none; background: none; }
        .tab.active { color: var(--gold); }
        .tab-icon { font-size: 1.4rem; margin-bottom: 2px; }

        /* Map Marker Customization */
        .leaflet-popup-content-wrapper { background: var(--card); color: white; border: 1px solid var(--gold); }
        .leaflet-popup-tip { background: var(--gold); }
    </style>
</head>
<body>

<header><h1>West End Explorer</h1></header>

<div id="content">
    <div id="listView">
        <div class="search-box">
            <input type="text" id="find" placeholder="Search show or theatre..." onkeyup="search()">
        </div>
        <div class="list" id="list"></div>
    </div>
    <div id="map"></div>
</div>

<nav class="tab-bar">
    <button class="tab active" id="listBtn" onclick="showTab('list')">
        <span class="tab-icon">üìú</span><span>List</span>
    </button>
    <button class="tab" id="mapBtn" onclick="showTab('map')">
        <span class="tab-icon">üó∫Ô∏è</span><span>Map</span>
    </button>
</nav>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const data = [
    // SECTION 1: VICTORIA
    {n: "Victoria Palace", s: "Hamilton", a: "Victoria St", lat: 51.4968, lon: -0.1420},
    {n: "Apollo Victoria", s: "Wicked", a: "17 Wilton Rd", lat: 51.4958, lon: -0.1427},
    
    // SECTION 2: ST JAMES'S & HAYMARKET
    {n: "Trafalgar Theatre", s: "Oh, Mary!", a: "14 Whitehall", lat: 51.5068, lon: -0.1274},
    {n: "Theatre Royal Haymarket", s: "Othello", a: "Haymarket", lat: 51.5084, lon: -0.1314},
    {n: "His Majesty's", s: "Phantom of the Opera", a: "Haymarket", lat: 51.5082, lon: -0.1318},
    {n: "Harold Pinter Theatre", s: "High Noon", a: "Panton St", lat: 51.5101, lon: -0.1312},
    {n: "Criterion Theatre", s: "Titanique", a: "218 Piccadilly", lat: 51.5101, lon: -0.1338},

    // SECTION 3: PICCADILLY & LEICESTER SQ
    {n: "Piccadilly Theatre", s: "Moulin Rouge!", a: "16 Denman St", lat: 51.5111, lon: -0.1345},
    {n: "Prince of Wales", s: "The Book of Mormon", a: "Coventry St", lat: 51.5104, lon: -0.1318},
    {n: "Wyndham's Theatre", s: "All My Sons", a: "Charing Cross Rd", lat: 51.5116, lon: -0.1283},
    {n: "No√´l Coward Theatre", s: "The Importance of Being Earnest", a: "St Martin's Ln", lat: 51.5109, lon: -0.1278},
    {n: "Duke of York's", s: "Woman in Mind", a: "St Martin's Ln", lat: 51.5105, lon: -0.1276},
    {n: "Garrick Theatre", s: "The Producers", a: "2 Charing Cross Rd", lat: 51.5098, lon: -0.1276},
    {n: "London Coliseum", s: "ENO / Seasonal", a: "St Martin's Ln", lat: 51.5099, lon: -0.1264},

    // SECTION 4: SHAFTESBURY AVENUE
    {n: "Lyric Theatre", s: "Hadestown", a: "29 Shaftesbury Ave", lat: 51.5112, lon: -0.1331},
    {n: "Apollo Theatre", s: "Christmas Carol Goes Wrong", a: "Shaftesbury Ave", lat: 51.5114, lon: -0.1329},
    {n: "Gielgud Theatre", s: "Oliver!", a: "Shaftesbury Ave", lat: 51.5116, lon: -0.1325},
    {n: "Sondheim Theatre", s: "Les Mis√©rables", a: "51 Shaftesbury Ave", lat: 51.5117, lon: -0.1325},
    {n: "Palace Theatre", s: "Harry Potter", a: "Shaftesbury Ave", lat: 51.5131, lon: -0.1299},
    {n: "Shaftesbury Theatre", s: "Just For One Day", a: "210 Shaftesbury Ave", lat: 51.5161, lon: -0.1263},

    // SECTION 5: CHARING CROSS & SOHO
    {n: "Phoenix Theatre", s: "Stranger Things", a: "Charing Cross Rd", lat: 51.5147, lon: -0.1292},
    {n: "Dominion Theatre", s: "The Devil Wears Prada", a: "Tottenham Ct Rd", lat: 51.5165, lon: -0.1298},
    {n: "Prince Edward", s: "MJ The Musical", a: "Old Compton St", lat: 51.5135, lon: -0.1305},
    {n: "London Palladium", s: "Waiting for Godot", a: "8 Argyll St", lat: 51.5145, lon: -0.1402},
    {n: "@sohoplace", s: "Spy Who Came In From The Cold", a: "4 Soho Pl", lat: 51.5159, lon: -0.1302},

    // SECTION 6: SEVEN DIALS & DRURY LANE
    {n: "Cambridge Theatre", s: "Matilda", a: "Earlham St", lat: 51.5135, lon: -0.1266},
    {n: "St. Martin's Theatre", s: "The Mousetrap", a: "West St", lat: 51.5139, lon: -0.1276},
    {n: "Ambassadors", s: "Paranormal Activity", a: "West St", lat: 51.5137, lon: -0.1275},
    {n: "Arts Theatre", s: "The Choir of Man", a: "Great Newport St", lat: 51.5122, lon: -0.1276},
    {n: "Gillian Lynne", s: "My Neighbour Totoro", a: "166 Drury Ln", lat: 51.5150, lon: -0.1229},
    {n: "Theatre Royal Drury Lane", s: "Hercules", a: "Catherine St", lat: 51.5125, lon: -0.1206},
    {n: "Fortune Theatre", s: "Operation Mincemeat", a: "Russell St", lat: 51.5126, lon: -0.1213},

    // SECTION 7: COVENT GARDEN & ALDWYCH
    {n: "Lyceum Theatre", s: "The Lion King", a: "Wellington St", lat: 51.5116, lon: -0.1199},
    {n: "Novello Theatre", s: "Mamma Mia!", a: "Aldwych", lat: 51.5122, lon: -0.1189},
    {n: "Aldwych Theatre", s: "Elf The Musical", a: "49 Aldwych", lat: 51.5126, lon: -0.1182},
    {n: "Duchess Theatre", s: "The Play That Goes Wrong", a: "Catherine St", lat: 51.5120, lon: -0.1201},

    // SECTION 8: THE STRAND & EMBANKMENT
    {n: "Adelphi Theatre", s: "Back to the Future", a: "Strand", lat: 51.5099, lon: -0.1227},
    {n: "Vaudeville", s: "SIX", a: "404 Strand", lat: 51.5101, lon: -0.1219},
    {n: "Savoy Theatre", s: "Paddington", a: "Strand", lat: 51.5103, lon: -0.1203},
    {n: "Playhouse Theatre", s: "Cabaret", a: "Northumberland Ave", lat: 51.5071, lon: -0.1242}
];


let map, userMarker, markers = [];

// Tab Switching Logic
function showTab(tab) {
    document.getElementById('listView').style.display = tab === 'list' ? 'block' : 'none';
    document.getElementById('map').style.display = tab === 'map' ? 'block' : 'none';
    document.getElementById('listBtn').classList.toggle('active', tab === 'list');
    document.getElementById('mapBtn').classList.toggle('active', tab === 'map');
    
    if (tab === 'map') {
        setTimeout(() => { 
            map.invalidateSize(); 
            getLocation(); // Auto-center map on user when switching
        }, 100);
    }
}

// Map Initialization
function initMap() {
    map = L.map('map').setView([51.51, -0.13], 14);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    data.forEach(t => {
        const m = L.marker([t.lat, t.lon]).addTo(map)
            .bindPopup(`<b>${t.n}</b><br><i style="color:var(--gold)">${t.s}</i>`);
        markers.push(m);
    });
}

function ui(items) {
    document.getElementById('list').innerHTML = items.map(i => `
        <div class="card">
            <div class="info">
                <span class="n">${i.n}</span>
                <span class="s">üé≠ ${i.s}</span>
                ${i.d ? `<span class="dist">${i.d.toFixed(2)} km away</span>` : ''}
            </div>
        </div>
    `).join('');
}

function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(pos => {
            const {latitude, longitude} = pos.coords;
            
            // Update List Distances
            data.forEach(t => {
                const R = 6371;
                const dLat = (t.lat-latitude) * Math.PI/180;
                const dLon = (t.lon-longitude) * Math.PI/180;
                const a = Math.sin(dLat/2)**2 + Math.cos(latitude*Math.PI/180)*Math.cos(t.lat*Math.PI/180)*Math.sin(dLon/2)**2;
                t.d = R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            });
            data.sort((a,b) => a.d - b.d);
            ui(data);

            // Update Map User Location
            if (userMarker) map.removeLayer(userMarker);
            userMarker = L.circleMarker([latitude, longitude], {
                color: '#3498db', radius: 8, fillOpacity: 0.8
            }).addTo(map).bindPopup("You are here");
            
            if (document.getElementById('map').style.display === 'block') {
                map.setView([latitude, longitude], 15);
            }
        });
    }
}

function search() {
    const q = document.getElementById('find').value.toLowerCase();
    ui(data.filter(i => i.n.toLowerCase().includes(q) || i.s.toLowerCase().includes(q)));
}

initMap();
ui(data);
// Track position every 30 seconds
setInterval(getLocation, 30000); 
getLocation();
</script>
</body>
</html>
